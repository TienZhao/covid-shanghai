<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <!-- <title>é¦‹ä½¬èƒšç»¼åˆå¾ç–«æƒ…åœ°å›¾</title> -->
    <title>4æœˆ14æ—¥ï¼Œä¸Šæµ·åŠ æ²¹ï¼</title>
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" />
    <style>
        html,
        body,
        #container {
            height: 100%;
            width: 100%;
        }

        /*.btn {
            width: 10rem;
            margin-left: 6.8rem;
        }*/
        /*body,html{
           width: 100%;
           height: 100%;
           padding: 0;
           margin: 0;
        }
        #container{
           width: 100%;
           height: 100%;
           overflow: hidden;
        }*/
        #result{
            position: fixed;
            top: 10px;
            left: 10px;
            width: 350px;
            height: auto;
            /*line-height: 30px;*/
            text-align: left;
            background: transparent;
            border-radius: 7px;
            z-index: 99;
            /*background-color: white;*/
            font-size: small;
        }
        #result ul{
            list-style-type: none;
            margin: 0;
            padding: 0;
        }
        #result ul li{
            color: #000;
            padding: 7px;
            font-size: 14px;
            text-align: justify;
            border-bottom: 1px solid #D3D3D3
        }
        #result>div:last-child{
            display: flex;
            align-items: center;
        }
        .marker {
            position: absolute;
            top: 3px;
            left: 30px;
            color: black;
            padding: 4px 10px;
            box-shadow: 1px 1px 1px rgba(10, 10, 10, .2);
            white-space: nowrap;
            font-size: 12px;
            font-family: "";
            background-color: white;
            border-radius: 3px;
        }
        #noticeDiv{
            margin-top: 10px;
            width: 240px;
            height: auto;
            background: transparent;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .noticeText{ 
            margin: 0px;
            width: 100%;
            padding: 10px;
            display: flex;
            flex-direction: column;
            background: #FFFFFF;  
            opacity: 0.8;  
            text-align: left; 
            font-color: black;   
            font-size: 12px; 
            line-height: 20px;         
        }
        #donateDiv{
            margin-top: 10px;
            width: 240px;
            height: 550px;
            background: transparent;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
        }
        #buttonRow{
            width: 100%;
            background: transparent;
            display: flex;
            flex-direction: row;
        }
        .donateText{
            margin: 0px;
            width: 100%;
            padding: 10px;
            display: flex;
            flex-direction: column;
            background: #FFD700;    
            text-align: center;   
            line-height: 20px;
            font-size: 16px;
            font-color: black;     
        }
        .btn{
            width: 80px;
            height: 35px;
            color: #000000;
            border-color: #BBBBBB;
            font-size: 14px;
            border-width: 0.5px;
            border-radius: 5px;
            background: #FFD700;
            box-shadow: none;
            white-space: nowrap;
            overflow: hidden
        }
        .btn:hover{
            cursor: pointer;
        }
        .subbtn{
            margin-left: 10px;
            width: 60px;
            height: 35px;
            color: #000000;
            border-color: #BBBBBB;
            font-size: 14px;
            border-width: 0.5px;
            border-radius: 5px;
            background: #EEEEEE;
            box-shadow: none;
            white-space: nowrap;
            overflow: hidden
        }
        /*.btn{
            width: 90px;
            height: 35px;
            color: #000000;
            border-color: #BBBBBB;
            font-size: 14px;
            border-width: 0.5px;
            border-radius: 5px;
            background: #FFD700;
            box-shadow: none;
        }
        .btn:hover{
            cursor: pointer;
        }
        .subbtn{
            margin-left: 10px;
            width: 35px;
            height: 35px;
            color: #000000;
            border-color: #BBBBBB;
            font-size: 14px;
            border-width: 0.5px;
            border-radius: 5px;
            background: #FFFFFF;
            box-shadow: none;
        }*/
    </style>
</head>
<body>
    <div id='container'></div>
    <div id='result' width='100%'>
        <div id='buttonRow'>
            <!-- <button onclick='geoCode()' class='btn'>å“ªæœ‰é¦‹ä½¬èƒšï¼Ÿ</button> -->
            <button onclick='geoCode()' class='btn'>æ ‡è®°ç—…ä¾‹</button>
            <!-- <button onclick='btnShare()' class='btn'>åˆ†äº«</button> -->
            <button onclick='btnDonate()' class='subbtn'>æ”¯æŒ</button>
            <!-- <button onclick='btnAd()' class='subbtn'>é¢†åˆ¸</button> -->
            <button onclick='btnShare()' class='subbtn'>åˆ†äº«</button>
            <!-- <button onclick='btnAddress()' class='subbtn'>åœ°å€</button> -->

            <!-- <button onclick='geoCode()' class='btn'>è¿è¡ŒğŸ˜·</button>
            <button onclick='btnDonate()' class='subbtn'>ğŸ™Œ</button>
            <button onclick='btnShare()' class='subbtn'>ğŸ”—</button>
            <button onclick='btnAd()' class='subbtn'>ğŸ›’</button> -->
        </div>
        <div id='noticeDiv'>
            <div class="noticeText">
                <!-- <span>å¬è¯´é¡¾æ‘çš„æ¨±èŠ±å¾ˆç¾</span> -->
                <!-- <span>å®ƒä¹Ÿåœ¨èµ›åšç©ºé—´ä¸ºä½ é™é™ç»½æ”¾</span> -->
                <span>4æœˆ13æ—¥æ–°å¢2573+25146ï¼Œè¾ƒæ˜¨æ—¥+5%</span>
                <span>è¿‘14å¤©ç´¯è®¡10897+251725ï¼Œè¾ƒæ˜¨æ—¥+10%</span>
                <!-- <span><b>â—ä¸€æœ¬æ­£ç»â—</b> è¡¨æƒ…ä»£è¡¨è¿‘14å¤©é˜³æ€§åœ°å€,ä¸ä»£è¡¨å°é—­åœ°åŒºï¼å‡ æ¬¡æŠ¥å‘Šé˜³æ€§çš„ï¼Œå–æœ€åçš„æ—¥æœŸï¼åŠ è½½éœ€è¦çº¦30ç§’ã€‚</span> -->
                <!-- <span>å…¬å…ƒ3322å¹´3æœˆï¼Œé¦‹ä½¬èƒšç»¼åˆå¾<i>(Epicurean Syndrome)</i>ç–«æƒ…åœ¨åäº­å¿å‡ºç°ã€‚æ„ŸæŸ“è€…å…­ç¥æ— ä¸»ï¼Œé¥¥æ¸´éš¾è€ï¼Œåªæƒ³ä¸åœåƒé¸¡è…¿â€¦â€¦</span> -->
            </div>            
        </div>
        <div id='donateDiv' style="display: none;">
            <!-- <div class='donateText'>
                <span><b>åœ¨è¿™ä¸ªèŒ«ç„¶çš„æ˜¥å¤©</b></span>
                <span><b>ç»™ç”Ÿæ´»ä¸€ç‚¹ç›¼å¤´</b></span>
                <span><b>3/30æ–°è½¦é—´çº¿ä¸Šå¼€æ”¾å¤œ</b></span>
                <span><b><a href="https://yoopay.cn/event/93875362">ç‚¹å‡»æŠ¥åï¼Œå…è´¹å‚ä¸</a></b></span>
            </div> -->
            <!-- <img src="https://tienzhao.github.io/covid-shanghai/images/event_0330.jpg" width="240"/> -->
            <div class='donateText'> 
                <span><b>â—ä¸€æœ¬æ­£ç»â—</b></span>
                <span>å±•ç¤ºçš„æ˜¯14å¤©é˜³æ€§åœ°å€</span>
                <span>ä¸ä»£è¡¨å°é—­åœ°åŒº</span>
                <span>æœ¬ç«™ä»…ä¾›æ•°æ®å¯è§†åŒ–å­¦ä¹ </span>               
                <span>å®Œå…¨ä¸ä¿è¯æ•°æ®çœŸå®å‡†ç¡®</span>
                <span>çœ‹çœ‹åˆ«çš„ï¼š</span>
                <span><a href="voice20220402.html">ã€ç–¾æ§ç”µè¯ã€‘</a>ã€<a href="voice20220409.html">ã€ç–¾æ§æ•²é—¨ã€‘</a></span>
                <!-- <span>æœ¬é¡µé¢ä»…ä¾›æ•°æ®å¯è§†åŒ–å­¦ä¹ ï¼Œå®Œå…¨ä¸ä¿è¯æ•°æ®çœŸå®å‡†ç¡®ï¼Œæ•°æ®æºäºä¸Šæµ·å‘å¸ƒã€‚å¦‚æœæ‚¨å‘ç°äº†é”™è¯¯å’Œå»ºè®®ï¼Œæ¬¢è¿<a href="https://wj.qq.com/s2/9880542/aac8/">åé¦ˆ</a>ï¼</span> -->
                <span><a href="https://github.com/TienZhao/covid-shanghai">Github Repo</a> | <a href="https://wj.qq.com/s2/9880542/aac8/">æ„è§åé¦ˆ</a></span>
                <span><b>æ‰“èµåå—</b></span>
                <span><b>ç»™ä½œè€…æŠ•å–‚é¸¡è…¿ï¼</b></span>
                <!-- <span><b>Donate ï¿¥10</b></span>
                <span><b>Power our server!</b></span> -->
                <!-- <span><a href="https://github.com/TienZhao/covid-shanghai">Github Repo</a> | <a href="https://wj.qq.com/s2/9880542/aac8/">æ„è§åé¦ˆ</a></span> -->
            </div>
            <!-- <img src="images/donate2.jpg" width="326"/> -->
            <img src="https://tienzhao.github.io/covid-shanghai/images/donation2.jpg" width="240"/>

            <div class='donateText'>                
                <span><b>ç‰¹åˆ«æ„Ÿè°¢</b></span>
                <span>è¿™åº§åŸå¸‚æ‰€æœ‰çš„</span>
                <span>åŒ»æŠ¤äººå‘˜å’Œé˜²ç–«äººå‘˜</span>
                <span>ä»¥åŠ</span>
                <span>æ–°è½¦é—´åˆ›å®¢ç©ºé—´ã€</span>
                <span>@lcb931023ã€@Erickusã€</span>
                <span>**å¿ã€**æ˜ã€**å®‡ã€*ç‘¶ã€*é–ã€*å¥•ã€*éƒ‘ã€*æ¤¿ã€*çº¢ã€**æ€¡ã€**é˜³ã€*æ‚¦ã€**å–»ã€**å½¤ã€**è¶Šã€**ä¾ã€**å˜‰ã€*è¨€ã€**æ¸…ã€**ä¸œã€**æ¬£ã€A*yã€*ğŸ’ã€*æ˜‚ã€*å¼ºã€*Mã€*é¢–ã€**æ–Œã€L*sã€E*iã€S*eã€*ğ™®ã€B*gã€**è±ªã€**è¶…ã€**æ·ã€**å¥ã€*ç»¢ã€*é”Ÿã€*åã€*å…´ã€*æ«ã€*è²ã€*æ ¼ã€*ğŸ’ã€*å¦™ã€**é¹ã€**æ•ã€**æ…§ã€*ğŸ¡ã€*eã€*å­ã€*å§ã€*æ­ã€**æ¶µã€**ä¹‚ã€**æ°ã€*å‡¯ã€*ç‘¾ã€*èµ“ã€*å…°ã€*æ¬£ã€*ç¾½ã€*è¹ã€*æ«ã€*ï¼‰ã€*åˆšã€*å‡¯ã€**ä¸œã€*æ¶›ã€**èµŸã€**å—ã€**é¾™ã€**é€¸ã€*å•ã€T*mã€*è™¹ã€*é£ã€**èŠ¬ã€**æ˜Šã€*æƒç­‰æœ‹å‹ä»¬</span>
                <span><b>å¯¹ç‚¸é¸¡æœåŠ¡å™¨çš„æ”¯æŒï¼</b></span>
                <span>è¿˜è¦æ„Ÿè°¢</span>
                <span>ä¸Šæµ·å¥‰è´¤ã€ä¸Šæµ·å¾æ±‡ã€ä¸Šæµ·é•¿å®ã€æµ¦ä¸œå‘å¸ƒã€ä¸Šæµ·é™å®‰ã€ä¸Šæµ·å˜‰å®šã€ä¸Šæµ·è™¹å£ã€ä¸Šæµ·é»„æµ¦ã€ä¸Šæµ·æ¾æ±Ÿã€ä¸Šæµ·æ™®é™€ã€ié‡‘å±±ã€ä»Šæ—¥é—µè¡Œã€ä¸Šæµ·æ¨æµ¦ã€ä¸Šæµ·å´‡æ˜ã€ç»¿è‰²é’æµ¦ã€ä¸Šæµ·å®å±±å¾®ä¿¡å…¬ä¼—å¹³å°æä¾›æ•°æ®æ”¯æŒï¼</span>
                <span><b>æˆ‘ä»¬â¤ï¸ä¸Šæµ·ï¼</b></span>
            </div>
        </div>
    </div>
    <!-- æµé‡ç»Ÿè®¡ -->
    <script async src="https://static.getclicky.com/101358038.js"></script>
    <noscript><img alt="Clicky" width="1" height="1" src="https://in.getclicky.com/101358038ns.gif" /></noscript>
    <!-- <script async src="//static.getclicky.com/101358152.js"></script>
    <noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/101358152ns.gif" /></p></noscript>
    <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
    <script>LA.init({id: "Jd6toq6cCUPrCPUx",ck: "Jd6toq6cCUPrCPUx"})</script> -->
    <script type="text/javascript">
        window._AMapSecurityConfig = {
            securityJsCode:'44947b774bfbf1c390bc98539582d54b',
        }
    </script>
    <script type="text/javascript"
        src="https://webapi.amap.com/maps?v=1.4.15&key=3c7d273d58c66c01fb9549449af5684e&plugin=AMap.Geocoder"></script>
    <script type="text/javascript" src='positives.js'></script>
    <script type="text/javascript" src='lockdown.js'></script>
    <script type="text/javascript">
        var midRisks = ['é»„æµ¦åŒºé¡ºæ˜Œè·¯612å¼„12å·', 'å˜‰å®šåŒºé©¬é™†é•‡åº·å¹´è·¯261å·å·¥åœ°å®¿èˆ', 'å´‡æ˜åŒºé•¿å…´é•‡é•¿æ˜æ‘21é˜Ÿ', 'æµ¦ä¸œæ–°åŒºåŒ—è”¡é•‡è”å‹¤æ‘å†¯æ¡¥å—å®…', 'æµ¦ä¸œæ–°åŒºæ—¥äº¬è·¯88å·', 'æµ¦ä¸œæ–°åŒºåŒ—è”¡é•‡é¹é£è·¯411å¼„6å·', 'å˜‰å®šåŒºæ±Ÿæ¡¥é•‡å¢å»ºæ‘æŸ´ä¸­æ‘æ°‘ç»„', 'é—µè¡ŒåŒºæ¢…é™‡é•‡è®¸æ³¾æ‘å…«ç»„', 'å´‡æ˜åŒºé•¿å…´é•‡æ–°æ¸¯æ‘15é˜Ÿ', 'é—µè¡ŒåŒºæ¢…é™‡é•‡è¡Œå—æ‘ä¸‰é˜Ÿ', 'é—µè¡ŒåŒºåæ¼•é•‡è®¸æµ¦æ‘ä¸‰é˜Ÿ', 'æµ¦ä¸œæ–°åŒºåº·æ¡¥é•‡è‹—æ¡¥è·¯935å¼„19å·', 'æµ¦ä¸œæ–°åŒºå¾¡åŒ—è·¯235å·']
        var highRisks = []
        
        // var markerObjs = {};
        var map = new AMap.Map("container", {
            resizeEnable: true,
            center: [121.5, 31.25],
            zoom: 11
        });
        map.on('zoomend', mapZoomend);
        var zoom = map.getZoom();

        function btnDonate(){
            let noticeDiv = document.getElementById('noticeDiv');
            let donateDiv = document.getElementById('donateDiv');
            noticeDiv.style["display"] = noticeDiv.style["display"] == 'none'? 'flex' : 'none';
            donateDiv.style["display"] = noticeDiv.style["display"] == 'none'? 'flex' : 'none';
        }

        // function btnAd(){      
        //     window.location.href = "";
        // }

        function btnShare(){
            let transfer = document.createElement('input');
            document.body.appendChild(transfer);
            transfer.value = "ä¸Šæµ·ç–«æƒ…åœ°å›¾ \nhttps://tienzhao.github.io/covid-shanghai/shanghai.html?from=share";
            transfer.focus();
            transfer.select();
            if (document.execCommand('copy')) {
                document.execCommand('copy');
                alert("å¤åˆ¶æˆåŠŸï¼Œèµ¶ç´§å‘ç»™å¥½å‹å§ï¼");
            }
            transfer.blur();
            document.body.removeChild(transfer);
        }

        // å®šä½æ§ä»¶
        AMap.plugin('AMap.Geolocation', function() {
            var geolocation = new AMap.Geolocation({
                enableHighAccuracy: true,//ä½¿ç”¨é«˜ç²¾åº¦å®šä½
                buttonPosition:'LT',    //å®šä½æŒ‰é’®çš„åœé ä½ç½®
                buttonOffset: new AMap.Pixel(240, 10),//å®šä½æŒ‰é’®ä¸è®¾ç½®çš„åœé ä½ç½®çš„åç§»é‡
                // buttonOffset: new AMap.Pixel(245, 10),//å®šä½æŒ‰é’®ä¸è®¾ç½®çš„åœé ä½ç½®çš„åç§»é‡
                zoomToAccuracy: true,   //å®šä½æˆåŠŸåæ˜¯å¦è‡ªåŠ¨è°ƒæ•´åœ°å›¾è§†é‡åˆ°å®šä½ç‚¹
            });
            map.addControl(geolocation);        
        });
        // è®¾ç½®åœ°ç†ä½ç½®ç¼–ç ç»“æœçš„èŒƒå›´ä¸ºä¸Šæµ·å¸‚
        // var geocoder = new AMap.Geocoder({
        //     city: "021", 
        // });
        var markers = [];
        var marked = false;
        var positionData = {};
        var addressAllow = true;
        var addressOnDisplay = false;
        // åŠ è½½åæ ‡æ–‡ä»¶
        readTextFile("https://tienzhao.github.io/covid-shanghai/positions_new.json", function(text){
        // readTextFile("positions.json", function(text){
            positionData = JSON.parse(text);
            // geoCode(positionData);
        });

        // è¯»å–JSONæ–‡ä»¶
        function readTextFile(file, callback) {
            var rawFile = new XMLHttpRequest();
            rawFile.overrideMimeType("application/json");
            rawFile.open("GET", file, true);
            rawFile.onreadystatechange = function() {
                if (rawFile.readyState === 4 && rawFile.status == "200") {
                    callback(rawFile.responseText);
                }
            }
            rawFile.send(null);
        }

        function geoCode() {
            if (!marked){
                marked = true
                map.remove(markers);
                markers = [];
                // let step = 10;
                // æ—§æ–¹æ³•ï¼Œå°†ä¸­é«˜é£é™©åœ°å€æ·»åŠ åˆ°åœ°å€åˆ—è¡¨ä¸­
                // for (midRiskAdd of midRisks) {
                //     if(!adds.includes(midRiskAdd)){ adds.push(midRiskAdd); }
                // }
                // for (highRiskAdd of highRisks) {
                //     if(!adds.includes(highRiskAdd)){ adds.push(highRiskAdd); }
                // }
                // æ—§æ–¹æ³•
                // stepCode(adds, step);

                // 04-11
                // if (Object.keys(positionData).length) {
                //     for (labelString in positionData){
                //         let marker = updateContent(positionData[labelString], labelString);
                //         markers.push(marker);
                //     }
                // }
                // map.add(markers);

                // ä½¿ç”¨æµ·é‡ç‚¹åœ¨åœ°å›¾ä¸Šåšæ ‡è®°
                var style = [{
                    url: 'images/ewe_small.png',
                    anchor: new AMap.Pixel(9, 9),
                    size: new AMap.Size(17, 17)
                }, {
                    url: 'images/red_square_small.png',
                    anchor: new AMap.Pixel(9, 9),
                    size: new AMap.Size(17, 17)
                }, {
                    url: 'images/yellow_square_small.png',
                    anchor: new AMap.Pixel(9, 9),
                    size: new AMap.Size(17, 17)
                }, {
                    url: 'images/green_square_small.png',
                    anchor: new AMap.Pixel(9, 9),
                    size: new AMap.Size(17, 17)
                }
                ];

                massData = positives.concat(redZone).concat(yellowZone).concat(greenZone)
                var mass = new AMap.MassMarks(massData, {
                    opacity: 1,
                    zIndex: 111,
                    cursor: 'pointer',
                    style: style
                });

                var marker = new AMap.Marker({content: ' ', map: map});

                mass.on('mouseover', function (e) {
                    marker.setPosition(e.data.lnglat);
                    marker.setLabel({content: e.data.name})
                });

                mass.on('touchstart', function (e) {
                    marker.setPosition(e.data.lnglat);
                    marker.setLabel({content: e.data.name})
                });

                mass.setMap(map);

                drawBounds()
            }            
        }


        // åŠ è½½è¡Œæ”¿åŒºæ–‡ä»¶
        var districtData = {};
        readTextFile("https://tienzhao.github.io/covid-shanghai/districts.json", function(text){
            districtData = JSON.parse(text);
        });
        function drawBounds() {
            // ç¦»çº¿è·å–è¡Œæ”¿åŒºåˆ’æ–¹æ³•
            // åŠ è½½è¡Œæ”¿åŒºåˆ’æ’ä»¶
            // if(!district){
            //     //å®ä¾‹åŒ–DistrictSearch
            //     var opts = {
            //         subdistrict: 0,   //è·å–è¾¹ç•Œä¸éœ€è¦è¿”å›ä¸‹çº§è¡Œæ”¿åŒº
            //         extensions: 'all',  //è¿”å›è¡Œæ”¿åŒºè¾¹ç•Œåæ ‡ç»„ç­‰å…·ä½“ä¿¡æ¯
            //         level: 'district'  //æŸ¥è¯¢è¡Œæ”¿çº§åˆ«ä¸º å¸‚
            //     };
            //     district = new AMap.DistrictSearch(opts);
            // }
            //è¡Œæ”¿åŒºæŸ¥è¯¢
            // district.setLevel('district');


            // let redDistricts = ["é»„æµ¦åŒº","å¾æ±‡åŒº","é•¿å®åŒº","é™å®‰åŒº","æ™®é™€åŒº","è™¹å£åŒº","æ¨æµ¦åŒº","é—µè¡ŒåŒº","å®å±±åŒº","å˜‰å®šåŒº","æµ¦ä¸œæ–°åŒº","é‡‘å±±åŒº","æ¾æ±ŸåŒº","é’æµ¦åŒº","å¥‰è´¤åŒº","å´‡æ˜åŒº"]
            let redDistricts = ["é»„æµ¦åŒº","å¾æ±‡åŒº","é•¿å®åŒº","é™å®‰åŒº","æ™®é™€åŒº","è™¹å£åŒº","æ¨æµ¦åŒº","é—µè¡ŒåŒº"]
            //ç”Ÿæˆè¡Œæ”¿åŒºåˆ’polygon            
            for (d of redDistricts){
                polygons = [];
                var bounds = districtData[d];
                // ä¸€ä¸ªè¡Œæ”¿åŒºå¯èƒ½æœ‰å¤šæ¡ä¸ç›¸è¿çš„è¾¹ç•Œçº¿ï¼Œå¦‚å²›å±¿ï¼Œéœ€è¦å†æ¬¡éå†åˆ†åˆ«ç»˜å›¾ã€‚
                for (bound of bounds) {                    
                    var polygon = new AMap.Polygon({
                        strokeWeight: 1,
                        path: bound,
                        fillOpacity: 0.2,
                        fillColor: '#dd3333',
                        strokeColor: '#aa0000',
                        zIndex: 50,
                    });
                    polygons.push(polygon);
                }
                map.add(polygons);
            }
            let greenDistricts = ["å˜‰å®šåŒº","é‡‘å±±åŒº","å¥‰è´¤åŒº","å´‡æ˜åŒº"]
            //ç”Ÿæˆè¡Œæ”¿åŒºåˆ’polygon            
            for (d of greenDistricts){
                polygons = [];
                var bounds = districtData[d];
                // ä¸€ä¸ªè¡Œæ”¿åŒºå¯èƒ½æœ‰å¤šæ¡ä¸ç›¸è¿çš„è¾¹ç•Œçº¿ï¼Œå¦‚å²›å±¿ï¼Œéœ€è¦å†æ¬¡éå†åˆ†åˆ«ç»˜å›¾ã€‚
                for (bound of bounds) {                    
                    var polygon = new AMap.Polygon({
                        strokeWeight: 1,
                        path: bound,
                        fillOpacity: 0.2,
                        fillColor: '#33dd33',
                        strokeColor: '#00aa00',
                        zIndex: 50,
                    });
                    polygons.push(polygon);
                }
                map.add(polygons);
            }
        }

        // æ—§æ–¹æ³•
        // function stepCode(addressArray, step){
        //     if (addressArray.length > 0) {
        //         let stepEnd = Math.min(step, addressArray.length);
        //         geocoder.getLocation(addressArray.slice(0, stepEnd), function (status, result) {
        //             if (status === 'complete' && result.geocodes.length) {
        //                 if (result.geocodes.length != stepEnd){
        //                         console.log('Error occurred on geo-searching');
        //                         console.log(addressArray.slice(0, stepEnd));
        //                         console.log(result.geocodes)
        //                     }
        //                 for (var i = 0; i < result.geocodes.length; i += 1) {                            
        //                     updateContent(result.geocodes[i].location, addressArray[i])
        //                 }
        //             }
        //         });
        //         if (addressArray.length > step){
        //             setTimeout(function() {
        //                 stepCode(addressArray.slice(step), step);
        //             }, 1000);
        //         }
        //     }
        // }

        function updateContent(lonLat) {
            // å®šä¹‰iconå’Œä¸­å¿ƒç‚¹çš„åæ ‡ï¼Œåå·®å€¼ä¸º-50%*å›¾ç‰‡å¤§å°
            marker = new AMap.Marker({
                position: lonLat,
                offset: new AMap.Pixel(-12, -12)
            });

            // è‡ªå®šä¹‰ç‚¹æ ‡è®°å†…å®¹
            var markerContent = document.createElement("div");

            // ç‚¹æ ‡è®°ä¸­çš„å›¾æ ‡
            var markerImg = document.createElement("img");
            markerImg.className = "markerlnglat";
            // markerImg.src = "images/cheers.png";
            // markerImg.src = "images/goofy.png";
            markerImg.src = "images/cherry_blossom_small.png";
            markerContent.appendChild(markerImg);

            // é€šè¿‡é€æ˜åº¦å±•ç¤ºä¸åŒæ—¶é—´çš„æ–°å¢åœ°å€
            // æ„Ÿè°¢Eric Huçš„ä»£ç è´¡çŒ®ï¼
            if (lonLat.opacity != ""){
                // let currDate = new Date();
                // let publishDate = [lonLat.date.substring(4,4+2), lonLat.date.substring(6,6+2), lonLat.date.substring(0,4)] .join("/");
                // let deltaDays = (currDate.getTime() - Date.parse(publishDate)) / (1000*60*60*24);
                // deltaDays = Math.floor(deltaDays);
                // let alpha = 0.75;
                // let opacity = Math.max(14 - deltaDays + 1, 0) / 14 * alpha + (1 - alpha);
                // console.log(lonLat["label"], opacity)
                markerImg.style.opacity = lonLat.opacity;
            } else {
                markerImg.style.opacity = 1;
            }
            

            // ç‚¹æ ‡è®°ä¸­çš„æ–‡æœ¬
            var markerSpan = document.createElement("span");
            markerSpan.className = 'marker';

            // ä¸­é«˜é£é™©åœ°åŒºï¼Œä½¿ç”¨ç‰¹æ®Šæ ·å¼æ ‡è®°
            // let risky = false;
            // if (midRisks.includes(labelString)){ 
            //     labelString = 'ã€ä¸­é£é™©ã€‘ ' + labelString;
            //     markerSpan.style["background-color"] = "#FFD700" ;
            //     marker.setzIndex(101);
            // };
            // if (highRisks.includes(labelString)){ 
            //     labelString = 'ã€é«˜é£é™©ã€‘ ' + labelString;
            //     markerSpan.style["background-color"] = "#FF4500" ;
            //     marker.setzIndex(102);
            // };

            // ä¸­é«˜é£é™©åœ°åŒºï¼Œä½¿ç”¨ç‰¹æ®Šæ ·å¼æ ‡è®°
            let risky = false;
            if (lonLat.risk == 'mid'){ 
                markerSpan.style["background-color"] = "#FFD700" ;
                marker.setzIndex(101);
            };
            if (lonLat.risk == 'high'){ 
                markerSpan.style["background-color"] = "#FF4500" ;
                marker.setzIndex(102);
            };
            markerSpan.innerHTML = lonLat.label;
            // é•œå¤´èŒƒå›´å¤ªå¤§æ—¶å€™ï¼Œéšè—æ–‡æœ¬æ ‡è®°
            if (zoom < 14 || !addressAllow){ markerSpan.style["display"] = "none" };         
            markerContent.appendChild(markerSpan);

            marker.setContent(markerContent); //æ›´æ–°ç‚¹æ ‡è®°å†…å®¹       
            // marker.setMap(map);
            return marker
        }

        // ç›‘å¬é¼ æ ‡æ»šè½®ç»“æŸäº‹ä»¶
        function mapZoomend(){
            zoom = map.getZoom()
            let markerElements = document.getElementsByClassName("marker");
            if (zoom < 16 && !addressAllow){
                if (addressOnDisplay){
                    addressOnDisplay = false; 
                    for(let m = 0; m < markerElements.length; m++) {
                        markerElements[m].style["display"] = "none";
                    }
                }
            } else if (zoom >= 16 && addressAllow) {
                if (!addressOnDisplay){
                    addressOnDisplay = true; 
                    for(let m = 0; m < markerElements.length; m++) {
                        markerElements[m].style["display"] = "block";
                    }
                }                
            }
        }

        function btnAddress(){
            let markerElements = document.getElementsByClassName("marker");
            if (addressOnDisplay){
                addressOnDisplay = false; 
                addressAllow = false;
                for(let m = 0; m < markerElements.length; m++) {
                    markerElements[m].style["display"] = "none";
                }
            } else {
                addressOnDisplay = true; 
                addressAllow = true;
                for(let m = 0; m < markerElements.length; m++) {
                    markerElements[m].style["display"] = "block";
                }
            }
        }


        // ä¸ºäº†ç½‘ç»œå®‰å…¨ï¼Œé¿å…APIæ»¥ç”¨
        // å‚è€ƒï¼šhttps://www.cnblogs.com/moluy/p/14085173.html
        function destroyMap() {
            console.log('ä¸ºäº†é¿å…APIæ»¥ç”¨ï¼Œæœ¬ç½‘é¡µç¦æ­¢æ§åˆ¶å°è°ƒè¯•ã€‚\nä½ ä¹Ÿä¼šå¼€å‘ï¼Ÿä¸€èµ·ä¸ºä¸Šæµ·åšè´¡çŒ®ï¼\nhttps://github.com/TienZhao/covid-shanghai/')
            map && map.destroy();
            AMap = null;
        }
        //ç¦æ­¢F12é”®ç›˜äº‹ä»¶
        document.addEventListener('keydown', function(event){
           return 123 != event.keyCode || (event.returnValue = false)
        });
        //ç¦æ­¢å³é”®ã€é€‰æ‹©ã€å¤åˆ¶
        document.addEventListener('contextmenu', function(event){
           return event.returnValue = false
        })
        //æ£€æµ‹æ§åˆ¶å°é«˜åº¦å˜åŒ–
        function resize(){
            var threshold = 200;
            var widthThreshold = window.outerWidth - window.innerWidth > threshold;
            var heightThreshold = window.outerHeight - window.innerHeight > threshold;
            if(widthThreshold || heightThreshold){
                destroyMap();
            }
        }
        window.addEventListener('resize', resize);
        resize()
        //ç›‘å¬toStringæ–¹æ³•å’Œdomå±æ€§
        var observerConsole = {
            openCallback: function(){
                destroyMap();
                try {
                    window.open("about:blank", "_self")
                } catch(e) {
                    var btn = document.createElement("button");
                    btn.onclick = function() {
                        window.open("about:blank", "_self")
                    }
                    btn.click()
                }
            },
            observer: function(){
                //è¿™é‡Œä½¿ç”¨domå…ƒç´ ï¼Œåœ¨æ‰“å¼€æ§åˆ¶å°æ—¶æ‰ä¼šè®¡ç®—id
                var dom = document.createElement("div"), that = this;
                Object.defineProperty(dom, "id", {
                    get: function(){
                        that.openCallback()
                    }
                })
                //ieä¸æ”¯æŒconsole.table
                //console.info(dom);
                console.log(dom);
            },
            observerF: function(){
                var obj = Object.create(null), t = Date.now(), that = this;
                Object.defineProperty(obj, "a", {
                    get: function() {
                        if(Date.now() - t > 100){
                            that.openCallback()
                        }
                    }
                })
                setInterval(function(){
                    t = Date.now();
                    (function(){})["constructor"]("debugger")();//debugger;
                    console.log(obj.a);
                }, 200)
            },
            init: function(){
                var t = window.navigator.userAgent.toLowerCase();
                t.indexOf("firefox") >= 0 ? this.observerF() : this.observer();
            }
        }
        observerConsole.init();

//     </script>
// </body>
// </html>

